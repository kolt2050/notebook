# Приложение Notebook

Быстрый, легкий и портативный блокнот с поддержкой Markdown, вложенности документов и организации через Drag & Drop.

## Возможности
- **Редактирование текста**: Поддержка жирного шрифта, списков, изображений и форматирования.
- **Поддержка Markdown**: Импорт и экспорт всего блокнота или отдельных документов в формате Markdown.
- **Drag & Drop**: Удобная реорганизация структуры документов и ручная сортировка.
- **Портативность изображений**: Изображения хранятся прямо в базе данных в формате base64.
- **Поиск**: Быстрый полнотекстовый поиск с подсветкой совпадений.
- **Темная тема**: Современный и приятный для глаз интерфейс.

## Установка и запуск

Приложение контейнеризировано с помощью Docker для простого развертывания.

1.  **Клонируйте репозиторий**.
2.  **Запустите через Docker Compose**:
    ```bash
    docker compose up --build -d
    ```
3.  **Откройте приложение**: Перейдите по адресу [http://localhost:8005](http://localhost:8005) в вашем браузере.

---

## Структура проекта

### Обязательные файлы (для работы приложения)
- **`app/`**: Серверная часть приложения (FastAPI, SQLAlchemy).
  - `main.py`: Основной файл API и маршрутизации.
  - `models.py`, `schemas.py`, `database.py`: Работа с данными и схемой БД.
  - `services/`: Бизнес-логика (экспорт и др.).
- **`static/`**: Фронтенд приложения (HTML, CSS, JS).
- **`requirements.txt`**: Список зависимостей Python.
- **`Dockerfile` & `docker-compose.yml`**: Файлы для запуска в Docker (рекомендуемый способ).
- **`data/`**: Папка для хранения базы данных SQLite (`notebook.db`).

### Опциональные файлы (можно удалить)
- **`tests/`**: Автоматизированные тесты. Приложение будет работать без них, но они важны для разработки.
- **`pytest.ini`**: Конфигурация для запуска тестов.
- **`.vscode/`**: Настройки редактора VS Code.
- **`app/check_db.py`**: Вспомогательный скрипт для проверки состояния БД.
- **`static/md-syntax.html`**: Справочник по синтаксису Markdown.
- **`.gitignore`**: Инструкции для Git (какие файлы не загружать в репозиторий).
- **`README.md`**: Сама документация.

---



---

## Тестирование

Для обеспечения надежности приложения используются автоматизированные тесты на базе `pytest`. Тесты защищают проект от ошибок при добавлении новых функций.

### Структура тестов
Все файлы тестов находятся в папке `tests/`:
- `tests/test_export.py`: **Модульные тесты (Unit)**. Проверяют логику конвертации HTML в Markdown и метаданные. Используют моки (AsyncMock) для изоляции от базы данных.
- `tests/test_api.py`: **Интеграционные тесты**. Проверяют доступность и корректность ответов API-эндпоинтов.

### Запуск тестов
1. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
2. Запустите тесты из корня проекта:
   ```bash
   # Если pytest не распознан, используйте:
   python -m pytest
   
   # Или просто:
   pytest
   ```

### Безопасный деплой
Рекомендуется использовать связку команд для автоматической проверки перед сборкой Docker-образа:
```bash
pytest && docker compose up --build -d
```
Если хотя бы один тест не пройдет, сборка будет прервана, что предотвратит запуск нерабочего кода.

### Как добавлять новые тесты
- **Для логики**: Создавайте асинхронные функции в `tests/`, используя `@pytest.mark.asyncio`.
- **Для API**: Используйте `fastapi.testclient.TestClient` для имитации запросов к серверу.
- **Конфигурация**: Глобальные настройки тестов и асинхронного режима находятся в `pytest.ini`.

### Как интерпретировать результаты
При запуске `pytest` вы увидите текстовый отчет прямо в терминале:

**Успешные тесты (Все хорошо):**
```bash
collected 5 items
tests/test_api.py ...         [ 60%]
tests/test_export.py ..       [100%]
======= 5 passed in 0.12s =======
```
(Точки `.` означают, что тест пройден успешно).

**Ошибки в тестах (Что-то сломалось):**
```bash
tests/test_export.py F        [ 20%]
>>>> FAILURES >>>>
test_markdown_export_format:
assert "Wrong Title" in "# Root Doc"
======= 1 failed, 4 passed in 0.15s =======
```
`F` означает **Fail**. Pytest покажет конкретную строку кода и значение, которое вызвало ошибку, чтобы вы могли быстро её исправить.

---

## Документация базы данных

Приложение использует базу данных SQLite для хранения всех документов и изображений.

### Расположение базы данных
- **Внутри Docker**: `/app/data/notebook.db`
- **Локально (Хост)**: `./data/notebook.db`

### Описание схемы

#### 1. Таблица `documents`
Хранит страницы, их содержимое и иерархию.

| Столбец | Тип | Описание |
| :--- | :--- | :--- |
| `id` | INTEGER | Первичный ключ (ID). |
| `title` | TEXT | Заголовок документа. |
| `content` | TEXT | Содержимое в формате HTML. |
| `is_folder` | BOOLEAN | `True` (1) если это папка. |
| `parent_id` | INTEGER | ID родительского документа (иерархия). |
| `position` | INTEGER | Порядковый номер (сортировка Drag & Drop). |

#### 2. Таблица `images`
Хранит изображения в кодировке base64.

| Столбец | Тип | Описание |
| :--- | :--- | :--- |
| `id` | INTEGER | Первичный ключ. |
| `filename` | TEXT | Оригинальное имя файла. |
| `data` | TEXT | Данные изображения в base64. |

---

## Как получить доступ к данным

### Через Docker CLI (командная строка)
```bash
docker exec -it notebook-notebook-app-1 python -c "import sqlite3; conn = sqlite3.connect('/app/data/notebook.db'); cursor = conn.cursor(); cursor.execute('SELECT id, title, position, parent_id FROM documents'); [print(row) for row in cursor.fetchall()]; conn.close()"
```

### Через SQLite CLI
```bash
sqlite3 data/notebook.db
```

### Через графические инструменты (GUI)
Вы можете открыть файл `./data/notebook.db` через:
- **DB Browser for SQLite**
- **DBeaver**
- **Расширения VS Code для SQLite**